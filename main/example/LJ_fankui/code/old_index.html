<!-- 
	类注释
	@author sunxy
	@version 0.0
 -->
<@import value="iron.*" />
<@import value="root.*" />
<App>
	<TitleBar id="title"></TitleBar>
	<div id="content" style="overflow-y:scroll;height:100%;">
		<StateElement name="反馈信息" icon="img/icon/fankui.png" url="pages.Fankui" />
		<StateElement name="处警信息" icon="img/icon/chujing.png" url="pages.ChuJing" />
		<StateElement name="处理状态" icon="img/icon/chuli.png" url="pages.ChuLi" />
		<StateElement name="事件总结" icon="img/icon/shijian.png" url="pages.ShiJian" />
	</div>
</App>
<script>
	var _self = $(dom);
	function init(){
		var a = null;
		if(window.device){
			JUS.addModule(document.body,"pages.Wait",[],function(e){
				a = e;
			});
		}
		
		#content.find(">div").click(function(){
			if(!icc){
				Alert("正在获取数据");
				return;
			}
			if(!havData(icc)){
				Alert("此警情无反馈数据");
				return;
			}
			
			JUS.addModule(document.body,$(this).attr("url"));
		});
		if(window.device){
			console.log("alarmID",device.getAlarmId());
		}
		if(window.device){
			postToServ("case/icc/feedbackList",function(e){
				var json = JSON.parse(e);
				if(json.success == 1){
					icc = json.info;
					
					if(!havData(icc)){
						Alert("返回数据为空");
					}
				}else{
					console.log("error",e);
				}
				$(a).remove();
			//},JSON.stringify({"cmd":"feedbackList","para":{"caseId":device.getAlarmId()}}));
			},JSON.stringify({"cmd":"feedbackList","para":{"caseId":"2018103114490366547895"}}));
		}else{
			icc = icc_b;
		}
		
		
		/**
		 * 发送修改信息
		 */
		window.Submit = function(obj){
			var a = null;
			if(window.device){
				JUS.addModule(document.body,"pages.Wait",[],function(e){
					a = e;
				});
			}
			
			for(var i in icc){
				if(obj[i]){
					icc[i] = obj[i];
				}
			}
			var obj = {cmd:"feedbackToIcc",para:icc};
			postToServ("case/icc/feedbackToIcc",function(e){
				try{
					var json = JSON.parse(e);
					if(json.success == 1){
						icc = json.info;
						Alert("保存成功");
						$(a).remove();
					}else{
						Alert("保存失败");
					}
				}catch(e){
					Alert("保存失败");
					$(a).remove();
				}
				
				
			},JSON.stringify(obj));
			
		}
		title.enabledEdit = false;
	}
	
	function havData(){
		for(var i in icc){
			return true;
		}
		return false;
	}
</script>