<!-- 省份选择 -->
<css>
	body{
		box-sizing:border-box;
		position:fixed;
		flex-direction:column;
		display:flex;
		background-color:rgba(0,0,0,0.2);
		justify-content:center;
		align-items:center;
		left:0px;
		top:0px;
		width:100%;
		height:100%;
	}
	.title{
		display:flex;
		position:relative;
		flex-shrink: 0;
		align-items:center;
		justify-content:center;
		font-size:14px;
		height:36px;
		background-color:#f5f5f5;
		text-align:center;
	}
	.header{
		display:flex;
		flex-shrink: 0;
		align-items:center;
		height:36px;
		background-color:#ffffff;
		text-align:center;
		border-bottom:1px solid #dddddd;
		padding-left:10px;
		box-sizing:border-box;
	}
	.header .label{
		font-size:14px;
		margin: 0px 10px 0px 0px;
		padding: 7px 0px 7px 0px;
		border-bottom:1px solid #ffffff;
		display:none;
		white-space: nowrap;
		overflow:hidden;
		text-overflow:ellipsis;
	}
	
	.header .label>span{
		color:#3E65F1;
	}
	
	.header .label.selected{
		border-bottom:2pt solid #3E65F1;
	}
	.panel{
		display:flex;
		flex-direction:column;
		overflow:hidden;
		background-color:#ffffff;
		padding:10px;
		height:100%;

	}
	.option{
		font-size: 14px;
		line-height: 26px;
		color:#444444;
	}
	
	.option.selected{
		color:#3E65F1;
		background:url(img/icon/sel.png) no-repeat;
		background-position:100% center;
		background-size: 8px;
		padding-right: 15px;
	}
	
	.pro{
		overflow: hidden;
		overflow-y: auto;
		display: flex;
		flex-direction: column;
		align-items: flex-start;
	}
</css>
<div>
	<div id="closeBtn" style="width:100%;height:100%;"></div>
	<div id="panel" style="display:flex;flex-direction:column;width:100%;height:100%;justify-content:flex-end">
		<div class="title">
			<div>请选择区域</div>
		</div>
		<div id="header" class="header">
			<div id="p0" class="label selected"><span>请选择</span></div>
			<div id="p1" class="label"><span>请选择</span></div>
			<div id="p2" class="label"><span>请选择</span></div>
			<div id="p3" class="label"><span>请选择</span></div>
		</div>
		<div class="panel">
			<div id="pro" class="pro"></div>
		</div>
	</div>
	
</div>
<script>
	private var current = 0;
	var _self = $("#$panel");
	var obj = null;
	var attr = null;
	function init(obj,address){
		this.obj = obj;
		#closeBtn.click(function(){
			$(dom).remove();
		});
		if(address){
			var foo = null;
			var fvv = null;
			p0.setAttribute("value",address.province);
			p0.innerText = address.provinceName;
			#p0.show();
			if(address.province){
				foo = loadProvince;
				fvv = "0";
				p1.setAttribute("value",address.city);
				p1.innerText = address.cityName;
				#p1.show();
				current = 0;
				
			}
			
			if(address.city){
				foo = loadCity;
				fvv = p0.getAttribute("value")
				p2.setAttribute("value",address.district);
				p2.innerText = address.districtName;
				#p2.show();
				current = 1;
			}
			
			if(address.district){
				foo = loadDistrict;
				fvv = p1.getAttribute("value")
				p3.setAttribute("value",address.town);
				p3.innerText = address.townName;
				current = 2;
			}
			
			
			if(address.town){
				foo = loadTown;
				fvv = p2.getAttribute("value")
				current = 3;
			}
			render();
			foo(fvv);	
			
		}else{
			loadProvince(0);
		}
		$(header).on("click",".label",function(){
			switch(this.getAttribute("src_id")){
				case "p0" :
					current = 0;
					p1.innerHTML = "<span>请选择<span>";
					p2.innerHTML = "<span>请选择<span>";
					p3.innerHTML = "<span>请选择<span>";
					loadProvince(0);
				break;
				case "p1" :
					current = 1;
					p2.innerHTML = "<span>请选择<span>";
					p3.innerHTML = "<span>请选择<span>";
					loadCity(p0.getAttribute("value"));
				break;
				case "p2" :
					current = 2;
					p3.innerHTML = "<span>请选择<span>";
					loadDistrict(p1.getAttribute("value"));
				break;
				case "p3" :
					current = 3;
					loadTown(p2.getAttribute("value"));
				break;
			}
		});
		$(pro).on("click",".option",function(){
			switch(current){
				case 0 :
					p0.innerText = this.innerText;
					p0.setAttribute("value",this.getAttribute("value"));
					current = 1;
					pro.innerHTML = "";
					loadCity(this.getAttribute("value"));
				break;
				case 1 :
					p1.innerText = this.innerText;
					p1.setAttribute("value",this.getAttribute("value"));
					current = 2;
					pro.innerHTML = "";
					loadDistrict(this.getAttribute("value"));
				break;
				case 2 :
					p2.innerText = this.innerText;
					p2.setAttribute("value",this.getAttribute("value"));
					current = 3;
					pro.innerHTML = "";
					loadTown(this.getAttribute("value"));
				break;
				case 3 :
					p3.innerText = this.innerText;
					p3.setAttribute("value",this.getAttribute("value"));
					submitEvt();//finish
				break;
			}
			#pro.empty();
		});
	}
	
	function loadProvince(parentId:String){
		_self.css("pointer-events","none");
		asjs.load(HOST + "dict?cmd=jqlx&key=DIC003",function(e){
			_self.css("pointer-events","auto");
			var data = e.target.data;
			var xml = new XML(data);
			if(xml.child("mess") == "success"){
				data = xml.child("data");
				var str = "";
				var p = null;
				var txt = "";
				for(var i = 0;i<data.length();i++){
					p = data.at(i);
					if(p.qname("value") == p0.innerText){
						txt = " selected";
					}else{
						txt = "";
					}
					str += "<div class='option" + txt + "' value='" + p.qname("dictinfokey") + "'>" + p.qname("value") + "</div>";
				}
				pro.innerHTML = str;
				render();
			}
			
		});
	}
	
	function loadCity(parentId:String){
		_self.css("pointer-events","none");
		asjs.load(HOST + "dict?cmd=jqlx&key=" + parentId,function(e){
			_self.css("pointer-events","auto");
			var data = e.target.data;
			var xml = new XML(data);
			if(xml.child("mess") == "success"){
				data = xml.child("data");
				var str = "";
				var p = null;
				var txt = "";
				for(var i = 0;i<data.length();i++){
					p = data.at(i);
					if(p.qname("value") == p0.innerText){
						txt = " selected";
					}else{
						txt = "";
					}
					str += "<div class='option" + txt + "' value='" + p.qname("dictinfokey") + "'>" + p.qname("value") + "</div>";
				}
				pro.innerHTML = str;
				render();
				
			}
			
		});
	}
	
	function loadDistrict(parentId){
		_self.css("pointer-events","none");
		asjs.load(HOST + "dict?cmd=jqlx&key=" + parentId,function(e){
			_self.css("pointer-events","auto");
			var data = e.target.data;
			var xml = new XML(data);
			if(xml.child("mess") == "success"){
				data = xml.child("data");
				var str = "";
				var p = null;
				var txt = "";
				for(var i = 0;i<data.length();i++){
					p = data.at(i);
					if(p.qname("value") == p0.innerText){
						txt = " selected";
					}else{
						txt = "";
					}
					str += "<div class='option" + txt + "' value='" + p.qname("dictinfokey") + "'>" + p.qname("value") + "</div>";
				}
				pro.innerHTML = str;
				render();
			}else{
				submitEvt();
			}
			
		});
	}
	
	function loadTown(parentId){
		_self.css("pointer-events","none");
		asjs.load(HOST + "dict?cmd=jqlx&key=" + parentId,function(e){
			_self.css("pointer-events","auto");
			var data = e.target.data;
			var xml = new XML(data);
			if(xml.child("mess") == "success"){
				data = xml.child("data");
				var str = "";
				var p = null;
				var txt = "";
				for(var i = 0;i<data.length();i++){
					p = data.at(i);
					if(p.qname("value") == p0.innerText){
						txt = " selected";
					}else{
						txt = "";
					}
					str += "<div class='option" + txt + "' value='" + p.qname("dictinfokey") + "'>" + p.qname("value") + "</div>";
				}
				pro.innerHTML = str;
				render();
			}else if(json.mess == "无记录"){
				pro.innerHTML = "";
				submitEvt();
			}
			
		});
	}
	
	
	function render(){
		$(dom).find(".label").removeClass("selected");
		if(current == 0){//选择省
			$(p0).show().addClass("selected");
			$(p1).hide().removeAttr("value");
			$(p2).hide().removeAttr("value");
			$(p3).hide().removeAttr("value");
		}else if(current == 1){
			$(p1).show().addClass("selected");
			$(p2).hide().removeAttr("value");
			$(p3).hide().removeAttr("value");
		}else if(current == 2){
			$(p2).show().addClass("selected");
			$(p3).hide().removeAttr("value");
		}else if(current == 3){
			$(p3).show().addClass("selected");
			p3.innerHTML = "<span>请选择<span>";
		}
	}
	
	function submitEvt(){
		//{alarm_first_type_XXXX}-{alarm_second_type_XXXX}-{alarm_third_type_XXXX}-{alarm_fourth_type_XXXX}
		obj.dataProvider.alarm_first_type = p0.getAttribute("value");
		obj.dataProvider.alarm_first_type_XXXX = p0.innerText;
		if(p1.getAttribute("value")){
			obj.dataProvider.alarm_second_type = p1.getAttribute("value");
			obj.dataProvider.alarm_second_type_XXXX = p1.innerText;
		}
		
		if(p2.getAttribute("value")){
			obj.dataProvider.alarm_third_type = p1.getAttribute("value");
			obj.dataProvider.alarm_third_type_XXXX = p2.innerText;
		}
		
		if(p3.getAttribute("value")){
			obj.dataProvider.alarm_fourth_type = p1.getAttribute("value");
			obj.dataProvider.alarm_fourth_type_XXXX = p3.innerText;
		}
		
		$(dom).remove();
	}
	
</script>